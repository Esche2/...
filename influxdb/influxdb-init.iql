CREATE RETENTION POLICY "forever" ON telegraf DURATION INF REPLICATION 1 SHARD DURATION 7d;
CREATE RETENTION POLICY "yearly" ON telegraf DURATION 52w REPLICATION 1 SHARD DURATION 7d;
CREATE RETENTION POLICY "monthly" ON telegraf DURATION 30d REPLICATION 1 SHARD DURATION 1d;
CREATE RETENTION POLICY "weekly" ON telegraf DURATION 7d REPLICATION 1 SHARD DURATION 1d;
CREATE RETENTION POLICY "daily" ON telegraf DURATION 24h REPLICATION 1 SHARD DURATION 1h;
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_forever" ON "telegraf" BEGIN SELECT MAX("battery_capacity") AS "battery_capacity", MAX("battery_capacity_1") AS "battery_capacity_1", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_health") AS "battery_health", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_temp") AS "battery_temp", MAX("battery_voltage") AS "battery_voltage", MAX("co2_emission_reduction") AS "co2_emission_reduction", MAX("current_phase_a") AS "current_phase_a", MAX("current_phase_b") AS "current_phase_b", MAX("current_phase_c") AS "current_phase_c", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_discharge_energy") AS "daily_discharge_energy", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_output_energy") AS "daily_output_energy", MAX("daily_pv_energy") AS "daily_pv_energy", MAX("daily_use_energy") AS "daily_use_energy", MAX("export_power") AS "export_power", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_import_or_export") AS "grid_import_or_export", MAX("grid_voltage_phase_a") AS "grid_voltage_phase_a", MAX("grid_voltage_phase_b") AS "grid_voltage_phase_b", MAX("grid_voltage_phase_c") AS "grid_voltage_phase_c", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temp") AS "internal_temp", MAX("inverter_ac_output") AS "inverter_ac_output", MAX("inverter_current") AS "inverter_current", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("mppt1_current") AS "mppt1_current", MAX("mppt1_voltage") AS "mppt1_voltage", MAX("mppt2_current") AS "mppt2_current", MAX("mppt2_voltage") AS "mppt2_voltage", MAX("nominal_output_power") AS "nominal_output_power", MAX("output_type") AS "output_type", MAX("power_factor") AS "power_factor", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("pv_power") AS "pv_power", MAX("running_state") AS "running_state", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_discharge_energy") AS "total_discharge_energy", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_output_energy") AS "total_output_energy", MAX("total_pv_energy") AS "total_pv_energy", MAX("total_use_energy") AS "total_use_energy", MAX("use_power") AS "use_power", MAX("reactive_power") as "reactive_power" INTO "forever"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(1h) END;
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_yearly" ON "telegraf" BEGIN SELECT MAX("battery_capacity") AS "battery_capacity", MAX("battery_capacity_1") AS "battery_capacity_1", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_health") AS "battery_health", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_temp") AS "battery_temp", MAX("battery_voltage") AS "battery_voltage", MAX("co2_emission_reduction") AS "co2_emission_reduction", MAX("current_phase_a") AS "current_phase_a", MAX("current_phase_b") AS "current_phase_b", MAX("current_phase_c") AS "current_phase_c", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_discharge_energy") AS "daily_discharge_energy", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_output_energy") AS "daily_output_energy", MAX("daily_pv_energy") AS "daily_pv_energy", MAX("daily_use_energy") AS "daily_use_energy", MAX("export_power") AS "export_power", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_import_or_export") AS "grid_import_or_export", MAX("grid_voltage_phase_a") AS "grid_voltage_phase_a", MAX("grid_voltage_phase_b") AS "grid_voltage_phase_b", MAX("grid_voltage_phase_c") AS "grid_voltage_phase_c", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temp") AS "internal_temp", MAX("inverter_ac_output") AS "inverter_ac_output", MAX("inverter_current") AS "inverter_current", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("mppt1_current") AS "mppt1_current", MAX("mppt1_voltage") AS "mppt1_voltage", MAX("mppt2_current") AS "mppt2_current", MAX("mppt2_voltage") AS "mppt2_voltage", MAX("nominal_output_power") AS "nominal_output_power", MAX("output_type") AS "output_type", MAX("power_factor") AS "power_factor", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("pv_power") AS "pv_power", MAX("running_state") AS "running_state", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_discharge_energy") AS "total_discharge_energy", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_output_energy") AS "total_output_energy", MAX("total_pv_energy") AS "total_pv_energy", MAX("total_use_energy") AS "total_use_energy", MAX("use_power") AS "use_power", MAX("reactive_power") as "reactive_power" INTO "yearly"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(30m) END;
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_monthly" ON "telegraf" BEGIN SELECT MAX("battery_capacity") AS "battery_capacity", MAX("battery_capacity_1") AS "battery_capacity_1", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_health") AS "battery_health", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_temp") AS "battery_temp", MAX("battery_voltage") AS "battery_voltage", MAX("co2_emission_reduction") AS "co2_emission_reduction", MAX("current_phase_a") AS "current_phase_a", MAX("current_phase_b") AS "current_phase_b", MAX("current_phase_c") AS "current_phase_c", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_discharge_energy") AS "daily_discharge_energy", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_output_energy") AS "daily_output_energy", MAX("daily_pv_energy") AS "daily_pv_energy", MAX("daily_use_energy") AS "daily_use_energy", MAX("export_power") AS "export_power", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_import_or_export") AS "grid_import_or_export", MAX("grid_voltage_phase_a") AS "grid_voltage_phase_a", MAX("grid_voltage_phase_b") AS "grid_voltage_phase_b", MAX("grid_voltage_phase_c") AS "grid_voltage_phase_c", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temp") AS "internal_temp", MAX("inverter_ac_output") AS "inverter_ac_output", MAX("inverter_current") AS "inverter_current", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("mppt1_current") AS "mppt1_current", MAX("mppt1_voltage") AS "mppt1_voltage", MAX("mppt2_current") AS "mppt2_current", MAX("mppt2_voltage") AS "mppt2_voltage", MAX("nominal_output_power") AS "nominal_output_power", MAX("output_type") AS "output_type", MAX("power_factor") AS "power_factor", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("pv_power") AS "pv_power", MAX("running_state") AS "running_state", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_discharge_energy") AS "total_discharge_energy", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_output_energy") AS "total_output_energy", MAX("total_pv_energy") AS "total_pv_energy", MAX("total_use_energy") AS "total_use_energy", MAX("use_power") AS "use_power", MAX("reactive_power") as "reactive_power" INTO "monthly"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(10m) END;
CREATE CONTINUOUS QUERY "cq_mqtt_consumer_weekly" ON "telegraf" BEGIN SELECT MAX("battery_capacity") AS "battery_capacity", MAX("battery_capacity_1") AS "battery_capacity_1", MAX("battery_charging") AS "battery_charging", MAX("battery_current") AS "battery_current", MAX("battery_discharging") AS "battery_discharging", MAX("battery_health") AS "battery_health", MAX("battery_level") AS "battery_level", MAX("battery_power") AS "battery_power", MAX("battery_temp") AS "battery_temp", MAX("battery_voltage") AS "battery_voltage", MAX("co2_emission_reduction") AS "co2_emission_reduction", MAX("current_phase_a") AS "current_phase_a", MAX("current_phase_b") AS "current_phase_b", MAX("current_phase_c") AS "current_phase_c", MAX("daily_charge_energy") AS "daily_charge_energy", MAX("daily_discharge_energy") AS "daily_discharge_energy", MAX("daily_export_energy") AS "daily_export_energy", MAX("daily_import_energy") AS "daily_import_energy", MAX("daily_output_energy") AS "daily_output_energy", MAX("daily_pv_energy") AS "daily_pv_energy", MAX("daily_use_energy") AS "daily_use_energy", MAX("export_power") AS "export_power", MAX("feed_into_grid") AS "feed_into_grid", MAX("grid_frequency") AS "grid_frequency", MAX("grid_import_or_export") AS "grid_import_or_export", MAX("grid_voltage_phase_a") AS "grid_voltage_phase_a", MAX("grid_voltage_phase_b") AS "grid_voltage_phase_b", MAX("grid_voltage_phase_c") AS "grid_voltage_phase_c", MAX("import_from_grid") AS "import_from_grid", MAX("internal_temp") AS "internal_temp", MAX("inverter_ac_output") AS "inverter_ac_output", MAX("inverter_current") AS "inverter_current", MAX("load_active") AS "load_active", MAX("load_power") AS "load_power", MAX("mppt1_current") AS "mppt1_current", MAX("mppt1_voltage") AS "mppt1_voltage", MAX("mppt2_current") AS "mppt2_current", MAX("mppt2_voltage") AS "mppt2_voltage", MAX("nominal_output_power") AS "nominal_output_power", MAX("output_type") AS "output_type", MAX("power_factor") AS "power_factor", MAX("power_generated_from_load") AS "power_generated_from_load", MAX("power_generated_from_pv") AS "power_generated_from_pv", MAX("pv_power") AS "pv_power", MAX("running_state") AS "running_state", MAX("total_charge_energy") AS "total_charge_energy", MAX("total_dc_power") AS "total_dc_power", MAX("total_discharge_energy") AS "total_discharge_energy", MAX("total_export_energy") AS "total_export_energy", MAX("total_import_energy") AS "total_import_energy", MAX("total_output_energy") AS "total_output_energy", MAX("total_pv_energy") AS "total_pv_energy", MAX("total_use_energy") AS "total_use_energy", MAX("use_power") AS "use_power", MAX("reactive_power") as "reactive_power" INTO "weekly"."mqtt_consumer" FROM "daily"."mqtt_consumer" GROUP BY time(1m) END;
ALTER RETENTION POLICY "daily" ON "telegraf" DEFAULT;
use telegraf;
INSERT INTO forever rp_config rp="daily" 86401000000000
INSERT INTO forever rp_config rp="weekly" 604801000000000
INSERT INTO forever rp_config rp="monthly" 2592001000000000
INSERT INTO forever rp_config rp="yearly" 31536001000000000
INSERT INTO forever rp_config rp="forever" 9223372036854775806